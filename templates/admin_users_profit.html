{% extends "base.html" %}
{% block title %}Admin / Users – BUY BIT{% endblock %}
{% block content %}
<div class="container">
  <!-- <div class="mb-3 d-flex justify-content-between">
    <a class="btn btn-sm btn-outline-light" href="{{ url_for('dashboard') }}">← Back to dashboard</a>
    <a class="btn btn-sm btn-outline-light" href="{{ url_for('admin_home') }}">Admin home</a>
  </div> -->

  <div class="glass-box p-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <a class="btn btn-sm btn-outline-light" href="{{ url_for('admin_home') }}">Admin home</a>
      <a class="btn btn-sm btn-outline-light" href="{{ url_for('dashboard') }}">← Back to dashboardd</a>      
    </div>
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="m-0">Admin / Users</h5>
      <form method="get" class="d-flex gap-2">
        <input class="form-control form-control-sm" name="q" value="{{ q or '' }}" placeholder="Search username or amount">
        <button class="btn btn-sm btn-outline-gold">Search</button>
      </form>
    </div>
    
    <div class="table-responsive">
      <table class="table table-sm align-middle text-white-50">
        <thead>
            <tr>
                <th>Username</th>
                <!-- <th>Parent ID</th> -->
                <th>PayPal Email</th>
                <th>Total Profit (£)</th>
                <th>Weekly Profit (£)</th>
                <th>Admin</th>
                <th>Created At</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user['username'] }}</td>
                <!-- <td>{{ user['parent_id'] or '-' }}</td> -->
                <td>{{ user['paypal_email'] or '-' }}</td>
                <!-- <td>{{ profit_dict.get(user['username'], 0) }}</td> -->
                <td>£{{ "%.2f"|format(profit_dict[user.username].total) }}</td>
                <td>£{{ "%.2f"|format(profit_dict[user.username].weekly) }}</td>
                <td>{{ 'Yes' if user['is_admin'] else 'No' }}</td>
                <td>{{ user['created_at'] }}</td>
            </tr>
            {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
<!-- Pagination -->
<nav aria-label="Page navigation">
  <ul class="pagination justify-content-end">
    {% if page > 1 %}
    <li class="page-item">
      <a class="page-link" href="{{ url_for('admin_users_profits', page=page-1, q=q) }}">Previous</a>
    </li>
    {% else %}
    <li class="page-item disabled"><span class="page-link">Previous</span></li>
    {% endif %}

    {% for p in range(1, total_pages + 1) %}
      <li class="page-item {% if p == page %}active{% endif %}">
        <a class="page-link" href="{{ url_for('admin_users_profits', page=p, q=q) }}">{{ p }}</a>
      </li>
    {% endfor %}

    {% if page < total_pages %}
    <li class="page-item">
      <a class="page-link" href="{{ url_for('admin_users_profits', page=page+1, q=q) }}">Next</a>
    </li>
    {% else %}
    <li class="page-item disabled"><span class="page-link">Next</span></li>
    {% endif %}
  </ul>
</nav>
<style>
  .pagination .page-link, .page-item.disabled .page-link{
    background-color: transparent;
  }
  nav{
    margin-top: 20px;
    padding-right: 15px;
  }
</style>
{% endblock %}
